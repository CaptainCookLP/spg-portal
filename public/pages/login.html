<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login - Mitgliederportal</title>
  
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/styles.css">
  
  <meta name="theme-color" content="#b91c1c">
  <meta name="description" content="Mitgliederportal für SPG Verein">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Portal">
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <div class="logo" id="logoBox">W</div>
        <div>
          <h1 id="siteTitle">Mitgliederportal</h1>
          <p id="siteSub" class="muted">Login</p>
        </div>
      </div>
      
      <div class="actions">
        <button class="btn" id="btnInstall" style="display:none">App installieren</button>
        <button class="btn" id="btnEnableNotif" style="display:none">Benachrichtigungen</button>
      </div>
    </header>

    <div id="toast" class="toast"></div>

    <main class="login-container">
      <section class="login-card">
        
        <!-- LOGIN FORM -->
        <div id="viewLogin" class="login-view">
          <div class="login-header">
            <h2>Willkommen zurück</h2>
            <p>Melden Sie sich mit Ihren Zugangsdaten an</p>
          </div>
          
          <div class="login-form">
            <div class="form-group">
              <label for="email">E-Mail-Adresse</label>
              <input id="email" type="text" placeholder="ihre.email@example.de" autocomplete="username" class="form-input" />
            </div>

            <div class="form-group">
              <label for="password">Passwort</label>
              <input id="password" type="password" placeholder="••••••••" autocomplete="current-password" class="form-input" />
            </div>

            <p id="loginError" class="form-error"></p>

            <button class="btn btn-primary btn-lg" id="btnLogin">
              <span class="btn-text">Anmelden</span>
              <span class="btn-loader" style="display:none">⏳</span>
            </button>
          </div>

          <div class="login-divider">oder</div>

          <button class="btn btn-secondary btn-lg" id="btnForgotPassword">
            Passwort zurücksetzen
          </button>
        </div>

        <!-- PASSWORD RESET REQUEST VIEW -->
        <div id="viewForgotPassword" class="login-view" style="display:none">
          <div class="login-header">
            <h2>Passwort vergessen?</h2>
            <p>Geben Sie Ihre E-Mail-Adresse ein, um einen Passwort-Reset-Link zu erhalten</p>
          </div>

          <div class="login-form">
            <div class="form-group">
              <label for="forgotEmail">E-Mail-Adresse</label>
              <input id="forgotEmail" type="text" placeholder="ihre.email@example.de" autocomplete="email" class="form-input" />
            </div>

            <p id="forgotErr" class="form-error"></p>
            <p id="forgotMsg" class="form-success" style="display:none"></p>

            <button class="btn btn-primary btn-lg" id="btnSendReset">
              Reset-Link senden
            </button>

            <button class="btn btn-secondary btn-lg" id="btnBackToLogin">
              Zurück zur Anmeldung
            </button>
          </div>
        </div>

        <!-- PASSWORD RESET VIEW -->
        <div id="viewResetPassword" class="login-view" style="display:none">
          <div class="login-header">
            <h2>Neues Passwort setzen</h2>
            <p>Wählen Sie ein sicheres Passwort aus</p>
          </div>

          <div class="login-form">
            <div class="form-group">
              <label for="resetPassword">Neues Passwort</label>
              <input id="resetPassword" type="password" placeholder="Mindestens 8 Zeichen" autocomplete="new-password" class="form-input" />
              <small class="form-hint">Verwenden Sie Groß- und Kleinbuchstaben, Zahlen und Sonderzeichen</small>
            </div>

            <div class="form-group">
              <label for="resetPasswordConfirm">Passwort wiederholen</label>
              <input id="resetPasswordConfirm" type="password" placeholder="Bestätigung" autocomplete="new-password" class="form-input" />
            </div>

            <p id="resetErr" class="form-error"></p>
            <p id="resetMsg" class="form-success" style="display:none"></p>

            <button class="btn btn-primary btn-lg" id="btnCompleteReset">
              Passwort setzen
            </button>
          </div>
        </div>
      </section>

      <div class="login-footer">
        <p>©2024 KG Wispelten - Mitgliederportal</p>
        <p><small>Passwörter werden sicher verschlüsselt gespeichert</small></p>
      </div>
    </main>
  </div>

  <script src="/shared/utils.js"></script>
  <script src="/shared/api.js"></script>
  <script src="/pages/login.js"></script>
</body>
</html>
